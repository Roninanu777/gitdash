import React, { useContext } from "react";
import routes from "../../routes/sidebar";
import { NavLink, Route } from "react-router-dom";
import * as Icons from "../../icons";
import SidebarSubmenu from "./SidebarSubmenu";
import githublight from "../../icons/github-light.png";
import githubdark from "../../icons/github-dark.png";
import { Button, WindmillContext } from "@windmill/react-ui";

function Icon({ icon, ...props }) {
  const Icon = Icons[icon];
  return <Icon {...props} />;
}

function SidebarContent(props) {
  const { mode } = useContext(WindmillContext);

  const handlePrompt = () => {
    props.deferredPrompt.prompt();
    props.deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === "accepted") {
        console.log("User accepted the install prompt");
      } else {
        console.log("User dismissed the install prompt");
      }
    });
  };

  return (
    <div className="h-full flex flex-col justify-between py-4 text-gray-500 dark:text-gray-400">
      <div>
        <a
          className="inline-block mt-4 ml-6 text-lg font-bold text-center text-gray-800 dark:text-gray-200"
          href="/"
        >
          <svg
            width="80"
            height="17"
            viewBox="0 0 80 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            {mode === "dark" ? (
              <React.Fragment>
                <path
                  d="M10.9168 8.78H13.8768V14.46C13.1168 15.0333 12.2368 15.4733 11.2368 15.78C10.2368 16.0867 9.23009 16.24 8.21675 16.24C6.76342 16.24 5.45675 15.9333 4.29675 15.32C3.13675 14.6933 2.22342 13.8333 1.55675 12.74C0.90342 11.6333 0.576753 10.3867 0.576753 9C0.576753 7.61333 0.90342 6.37333 1.55675 5.28C2.22342 4.17333 3.14342 3.31333 4.31675 2.7C5.49009 2.07333 6.81009 1.76 8.27675 1.76C9.50342 1.76 10.6168 1.96667 11.6168 2.38C12.6168 2.79333 13.4568 3.39333 14.1368 4.18L12.0568 6.1C11.0568 5.04667 9.85009 4.52 8.43675 4.52C7.54342 4.52 6.75009 4.70667 6.05675 5.08C5.36342 5.45333 4.82342 5.98 4.43675 6.66C4.05009 7.34 3.85675 8.12 3.85675 9C3.85675 9.86667 4.05009 10.64 4.43675 11.32C4.82342 12 5.35675 12.5333 6.03675 12.92C6.73009 13.2933 7.51675 13.48 8.39675 13.48C9.33009 13.48 10.1701 13.28 10.9168 12.88V8.78ZM16.6664 5.24H19.7864V16H16.6664V5.24ZM18.2264 3.74C17.6531 3.74 17.1864 3.57333 16.8264 3.24C16.4664 2.90667 16.2864 2.49333 16.2864 2C16.2864 1.50667 16.4664 1.09333 16.8264 0.76C17.1864 0.426666 17.6531 0.259999 18.2264 0.259999C18.7998 0.259999 19.2664 0.419999 19.6264 0.74C19.9864 1.06 20.1664 1.46 20.1664 1.94C20.1664 2.46 19.9864 2.89333 19.6264 3.24C19.2664 3.57333 18.7998 3.74 18.2264 3.74ZM29.6221 15.48C29.3154 15.7067 28.9354 15.88 28.4821 16C28.0421 16.1067 27.5754 16.16 27.0821 16.16C25.8021 16.16 24.8087 15.8333 24.1021 15.18C23.4087 14.5267 23.0621 13.5667 23.0621 12.3V7.88H21.4021V5.48H23.0621V2.86H26.1821V5.48H28.8621V7.88H26.1821V12.26C26.1821 12.7133 26.2954 13.0667 26.5221 13.32C26.7621 13.56 27.0954 13.68 27.5221 13.68C28.0154 13.68 28.4354 13.5467 28.7821 13.28L29.6221 15.48Z"
                  fill="#cf3e9e"
                />
                <path
                  d="M42.3335 1.16V16H39.3535V14.76C38.5801 15.6933 37.4601 16.16 35.9935 16.16C34.9801 16.16 34.0601 15.9333 33.2335 15.48C32.4201 15.0267 31.7801 14.38 31.3135 13.54C30.8468 12.7 30.6135 11.7267 30.6135 10.62C30.6135 9.51333 30.8468 8.54 31.3135 7.7C31.7801 6.86 32.4201 6.21333 33.2335 5.76C34.0601 5.30667 34.9801 5.08 35.9935 5.08C37.3668 5.08 38.4401 5.51333 39.2135 6.38V1.16H42.3335ZM36.5335 13.6C37.3201 13.6 37.9735 13.3333 38.4935 12.8C39.0135 12.2533 39.2735 11.5267 39.2735 10.62C39.2735 9.71333 39.0135 8.99333 38.4935 8.46C37.9735 7.91333 37.3201 7.64 36.5335 7.64C35.7335 7.64 35.0735 7.91333 34.5535 8.46C34.0335 8.99333 33.7735 9.71333 33.7735 10.62C33.7735 11.5267 34.0335 12.2533 34.5535 12.8C35.0735 13.3333 35.7335 13.6 36.5335 13.6ZM49.5611 5.08C51.2278 5.08 52.5078 5.48 53.4011 6.28C54.2945 7.06667 54.7411 8.26 54.7411 9.86V16H51.8211V14.66C51.2345 15.66 50.1411 16.16 48.5411 16.16C47.7145 16.16 46.9945 16.02 46.3811 15.74C45.7811 15.46 45.3211 15.0733 45.0011 14.58C44.6811 14.0867 44.5211 13.5267 44.5211 12.9C44.5211 11.9 44.8945 11.1133 45.6411 10.54C46.4011 9.96667 47.5678 9.68 49.1411 9.68H51.6211C51.6211 9 51.4145 8.48 51.0011 8.12C50.5878 7.74667 49.9678 7.56 49.1411 7.56C48.5678 7.56 48.0011 7.65333 47.4411 7.84C46.8945 8.01333 46.4278 8.25333 46.0411 8.56L44.9211 6.38C45.5078 5.96667 46.2078 5.64667 47.0211 5.42C47.8478 5.19333 48.6945 5.08 49.5611 5.08ZM49.3211 14.06C49.8545 14.06 50.3278 13.94 50.7411 13.7C51.1545 13.4467 51.4478 13.08 51.6211 12.6V11.5H49.4811C48.2011 11.5 47.5611 11.92 47.5611 12.76C47.5611 13.16 47.7145 13.48 48.0211 13.72C48.3411 13.9467 48.7745 14.06 49.3211 14.06ZM61.1849 16.16C60.2915 16.16 59.4182 16.0533 58.5649 15.84C57.7115 15.6133 57.0315 15.3333 56.5249 15L57.5649 12.76C58.0449 13.0667 58.6249 13.32 59.3049 13.52C59.9849 13.7067 60.6515 13.8 61.3049 13.8C62.6249 13.8 63.2849 13.4733 63.2849 12.82C63.2849 12.5133 63.1049 12.2933 62.7449 12.16C62.3849 12.0267 61.8315 11.9133 61.0849 11.82C60.2049 11.6867 59.4782 11.5333 58.9049 11.36C58.3315 11.1867 57.8315 10.88 57.4049 10.44C56.9915 10 56.7849 9.37333 56.7849 8.56C56.7849 7.88 56.9782 7.28 57.3649 6.76C57.7649 6.22667 58.3382 5.81333 59.0849 5.52C59.8449 5.22667 60.7382 5.08 61.7649 5.08C62.5249 5.08 63.2782 5.16667 64.0249 5.34C64.7849 5.5 65.4115 5.72667 65.9049 6.02L64.8649 8.24C63.9182 7.70667 62.8849 7.44 61.7649 7.44C61.0982 7.44 60.5982 7.53333 60.2649 7.72C59.9315 7.90667 59.7649 8.14667 59.7649 8.44C59.7649 8.77333 59.9449 9.00667 60.3049 9.14C60.6649 9.27333 61.2382 9.4 62.0249 9.52C62.9049 9.66667 63.6249 9.82667 64.1849 10C64.7449 10.16 65.2315 10.46 65.6449 10.9C66.0582 11.34 66.2649 11.9533 66.2649 12.74C66.2649 13.4067 66.0649 14 65.6649 14.52C65.2649 15.04 64.6782 15.4467 63.9049 15.74C63.1449 16.02 62.2382 16.16 61.1849 16.16ZM74.7299 5.08C76.0632 5.08 77.1365 5.48 77.9499 6.28C78.7765 7.08 79.1899 8.26667 79.1899 9.84V16H76.0699V10.32C76.0699 9.46667 75.8832 8.83333 75.5099 8.42C75.1365 7.99333 74.5965 7.78 73.8899 7.78C73.1032 7.78 72.4765 8.02667 72.0099 8.52C71.5432 9 71.3099 9.72 71.3099 10.68V16H68.1899V1.16H71.3099V6.36C71.7232 5.94667 72.2232 5.63333 72.8099 5.42C73.3965 5.19333 74.0365 5.08 74.7299 5.08Z"
                  fill="#F8F8F8"
                />
              </React.Fragment>
            ) : (
              <React.Fragment>
                <path
                  d="M10.9168 8.78H13.8768V14.46C13.1168 15.0333 12.2368 15.4733 11.2368 15.78C10.2368 16.0867 9.23009 16.24 8.21675 16.24C6.76342 16.24 5.45675 15.9333 4.29675 15.32C3.13675 14.6933 2.22342 13.8333 1.55675 12.74C0.90342 11.6333 0.576753 10.3867 0.576753 9C0.576753 7.61333 0.90342 6.37333 1.55675 5.28C2.22342 4.17333 3.14342 3.31333 4.31675 2.7C5.49009 2.07333 6.81009 1.76 8.27675 1.76C9.50342 1.76 10.6168 1.96667 11.6168 2.38C12.6168 2.79333 13.4568 3.39333 14.1368 4.18L12.0568 6.1C11.0568 5.04667 9.85009 4.52 8.43675 4.52C7.54342 4.52 6.75009 4.70667 6.05675 5.08C5.36342 5.45333 4.82342 5.98 4.43675 6.66C4.05009 7.34 3.85675 8.12 3.85675 9C3.85675 9.86667 4.05009 10.64 4.43675 11.32C4.82342 12 5.35675 12.5333 6.03675 12.92C6.73009 13.2933 7.51675 13.48 8.39675 13.48C9.33009 13.48 10.1701 13.28 10.9168 12.88V8.78ZM16.6664 5.24H19.7864V16H16.6664V5.24ZM18.2264 3.74C17.6531 3.74 17.1864 3.57333 16.8264 3.24C16.4664 2.90667 16.2864 2.49333 16.2864 2C16.2864 1.50667 16.4664 1.09333 16.8264 0.76C17.1864 0.426666 17.6531 0.259999 18.2264 0.259999C18.7998 0.259999 19.2664 0.419999 19.6264 0.74C19.9864 1.06 20.1664 1.46 20.1664 1.94C20.1664 2.46 19.9864 2.89333 19.6264 3.24C19.2664 3.57333 18.7998 3.74 18.2264 3.74ZM29.6221 15.48C29.3154 15.7067 28.9354 15.88 28.4821 16C28.0421 16.1067 27.5754 16.16 27.0821 16.16C25.8021 16.16 24.8087 15.8333 24.1021 15.18C23.4087 14.5267 23.0621 13.5667 23.0621 12.3V7.88H21.4021V5.48H23.0621V2.86H26.1821V5.48H28.8621V7.88H26.1821V12.26C26.1821 12.7133 26.2954 13.0667 26.5221 13.32C26.7621 13.56 27.0954 13.68 27.5221 13.68C28.0154 13.68 28.4354 13.5467 28.7821 13.28L29.6221 15.48Z"
                  fill="#AD5A91"
                />
                <path
                  d="M42.3335 1.16V16H39.3535V14.76C38.5801 15.6933 37.4601 16.16 35.9935 16.16C34.9801 16.16 34.0601 15.9333 33.2335 15.48C32.4201 15.0267 31.7801 14.38 31.3135 13.54C30.8468 12.7 30.6135 11.7267 30.6135 10.62C30.6135 9.51333 30.8468 8.54 31.3135 7.7C31.7801 6.86 32.4201 6.21333 33.2335 5.76C34.0601 5.30667 34.9801 5.08 35.9935 5.08C37.3668 5.08 38.4401 5.51333 39.2135 6.38V1.16H42.3335ZM36.5335 13.6C37.3201 13.6 37.9735 13.3333 38.4935 12.8C39.0135 12.2533 39.2735 11.5267 39.2735 10.62C39.2735 9.71333 39.0135 8.99333 38.4935 8.46C37.9735 7.91333 37.3201 7.64 36.5335 7.64C35.7335 7.64 35.0735 7.91333 34.5535 8.46C34.0335 8.99333 33.7735 9.71333 33.7735 10.62C33.7735 11.5267 34.0335 12.2533 34.5535 12.8C35.0735 13.3333 35.7335 13.6 36.5335 13.6ZM49.5611 5.08C51.2278 5.08 52.5078 5.48 53.4011 6.28C54.2945 7.06667 54.7411 8.26 54.7411 9.86V16H51.8211V14.66C51.2345 15.66 50.1411 16.16 48.5411 16.16C47.7145 16.16 46.9945 16.02 46.3811 15.74C45.7811 15.46 45.3211 15.0733 45.0011 14.58C44.6811 14.0867 44.5211 13.5267 44.5211 12.9C44.5211 11.9 44.8945 11.1133 45.6411 10.54C46.4011 9.96667 47.5678 9.68 49.1411 9.68H51.6211C51.6211 9 51.4145 8.48 51.0011 8.12C50.5878 7.74667 49.9678 7.56 49.1411 7.56C48.5678 7.56 48.0011 7.65333 47.4411 7.84C46.8945 8.01333 46.4278 8.25333 46.0411 8.56L44.9211 6.38C45.5078 5.96667 46.2078 5.64667 47.0211 5.42C47.8478 5.19333 48.6945 5.08 49.5611 5.08ZM49.3211 14.06C49.8545 14.06 50.3278 13.94 50.7411 13.7C51.1545 13.4467 51.4478 13.08 51.6211 12.6V11.5H49.4811C48.2011 11.5 47.5611 11.92 47.5611 12.76C47.5611 13.16 47.7145 13.48 48.0211 13.72C48.3411 13.9467 48.7745 14.06 49.3211 14.06ZM61.1849 16.16C60.2915 16.16 59.4182 16.0533 58.5649 15.84C57.7115 15.6133 57.0315 15.3333 56.5249 15L57.5649 12.76C58.0449 13.0667 58.6249 13.32 59.3049 13.52C59.9849 13.7067 60.6515 13.8 61.3049 13.8C62.6249 13.8 63.2849 13.4733 63.2849 12.82C63.2849 12.5133 63.1049 12.2933 62.7449 12.16C62.3849 12.0267 61.8315 11.9133 61.0849 11.82C60.2049 11.6867 59.4782 11.5333 58.9049 11.36C58.3315 11.1867 57.8315 10.88 57.4049 10.44C56.9915 10 56.7849 9.37333 56.7849 8.56C56.7849 7.88 56.9782 7.28 57.3649 6.76C57.7649 6.22667 58.3382 5.81333 59.0849 5.52C59.8449 5.22667 60.7382 5.08 61.7649 5.08C62.5249 5.08 63.2782 5.16667 64.0249 5.34C64.7849 5.5 65.4115 5.72667 65.9049 6.02L64.8649 8.24C63.9182 7.70667 62.8849 7.44 61.7649 7.44C61.0982 7.44 60.5982 7.53333 60.2649 7.72C59.9315 7.90667 59.7649 8.14667 59.7649 8.44C59.7649 8.77333 59.9449 9.00667 60.3049 9.14C60.6649 9.27333 61.2382 9.4 62.0249 9.52C62.9049 9.66667 63.6249 9.82667 64.1849 10C64.7449 10.16 65.2315 10.46 65.6449 10.9C66.0582 11.34 66.2649 11.9533 66.2649 12.74C66.2649 13.4067 66.0649 14 65.6649 14.52C65.2649 15.04 64.6782 15.4467 63.9049 15.74C63.1449 16.02 62.2382 16.16 61.1849 16.16ZM74.7299 5.08C76.0632 5.08 77.1365 5.48 77.9499 6.28C78.7765 7.08 79.1899 8.26667 79.1899 9.84V16H76.0699V10.32C76.0699 9.46667 75.8832 8.83333 75.5099 8.42C75.1365 7.99333 74.5965 7.78 73.8899 7.78C73.1032 7.78 72.4765 8.02667 72.0099 8.52C71.5432 9 71.3099 9.72 71.3099 10.68V16H68.1899V1.16H71.3099V6.36C71.7232 5.94667 72.2232 5.63333 72.8099 5.42C73.3965 5.19333 74.0365 5.08 74.7299 5.08Z"
                  fill="#394B59"
                />
              </React.Fragment>
            )}
          </svg>
        </a>
        <ul className="mt-6">
          {routes.map((route) =>
            route.routes ? (
              <SidebarSubmenu route={route} key={route.name} />
            ) : (
              <li className="relative px-6 py-3" key={route.name}>
                <NavLink
                  exact
                  to={route.path}
                  className="inline-flex items-center w-full text-sm font-semibold transition-colors duration-150 hover:text-gray-800 dark:hover:text-gray-200"
                  activeClassName="text-gray-800 dark:text-gray-100"
                >
                  <Route path={route.path} exact={route.exact}>
                    <span
                      className="absolute inset-y-0 left-0 w-1 bg-purple-600 rounded-tr-lg rounded-br-lg"
                      aria-hidden="true"
                    ></span>
                  </Route>
                  <Icon
                    className="w-5 h-5"
                    aria-hidden="true"
                    icon={route.icon}
                  />
                  <span className="ml-4">{route.name}</span>
                </NavLink>
              </li>
            )
          )}
        </ul>
        <div className="px-6 my-6">
          <Button
            onClick={handlePrompt}
            className={props.showPrompt ? "block" : "hidden"}
          >
            Install App
            <span className="ml-2" aria-hidden="true">
              +
            </span>
          </Button>
        </div>
      </div>
      <div className="border-t border-gray-200 dark:border-gray-600 text-center pt-4">
        <p className="tracking-wide font-semibold text-sm">
          Powered by{" "}
          {mode === "dark" ? (
            <img
              className="inline-block ml-4 w-4 h-4"
              src={githublight}
              alt="githublight"
            />
          ) : (
            <img
              className="inline-block ml-4 w-4 h-4"
              src={githubdark}
              alt="githubdark"
            />
          )}
        </p>
      </div>
    </div>
  );
}

export default SidebarContent;
